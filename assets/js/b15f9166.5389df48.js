"use strict";(globalThis.webpackChunkagentops_docs=globalThis.webpackChunkagentops_docs||[]).push([[2475],{6272(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"core-concepts/architecture","title":"Architecture","description":"Technical architecture of the AgentOps platform","source":"@site/docs/core-concepts/architecture.md","sourceDirName":"core-concepts","slug":"/core-concepts/architecture","permalink":"/docusaurus-guide-3/docs/core-concepts/architecture","draft":false,"unlisted":false,"editUrl":"https://github.com/agentops/agentops-docs/tree/main/docs/core-concepts/architecture.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"Architecture","description":"Technical architecture of the AgentOps platform"},"sidebar":"docsSidebar","previous":{"title":"Overview","permalink":"/docusaurus-guide-3/docs/core-concepts/overview"},"next":{"title":"Sessions","permalink":"/docusaurus-guide-3/docs/core-concepts/sessions"}}');var i=t(4848),r=t(8453);const a={sidebar_position:2,title:"Architecture",description:"Technical architecture of the AgentOps platform"},c="Architecture",l={},o=[{value:"System Overview",id:"system-overview",level:2},{value:"SDK Architecture",id:"sdk-architecture",level:2},{value:"Component Overview",id:"component-overview",level:3},{value:"Auto-Instrumentation",id:"auto-instrumentation",level:3},{value:"Event Queue",id:"event-queue",level:3},{value:"Data Models",id:"data-models",level:2},{value:"Session Schema",id:"session-schema",level:3},{value:"Event Schema",id:"event-schema",level:3},{value:"Agent Schema",id:"agent-schema",level:3},{value:"Communication Protocol",id:"communication-protocol",level:2},{value:"Event Submission",id:"event-submission",level:3},{value:"Response Format",id:"response-format",level:3},{value:"Security Architecture",id:"security-architecture",level:2},{value:"Authentication Flow",id:"authentication-flow",level:3},{value:"Data Encryption",id:"data-encryption",level:3},{value:"Scalability",id:"scalability",level:2},{value:"Horizontal Scaling",id:"horizontal-scaling",level:3},{value:"Data Partitioning",id:"data-partitioning",level:3},{value:"Performance Characteristics",id:"performance-characteristics",level:2},{value:"SDK Overhead",id:"sdk-overhead",level:3},{value:"API Latency",id:"api-latency",level:3},{value:"Reliability",id:"reliability",level:2},{value:"Retry Logic",id:"retry-logic",level:3},{value:"Failure Handling",id:"failure-handling",level:3},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",mermaid:"mermaid",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"architecture",children:"Architecture"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://images.unsplash.com/photo-1558494949-ef010cbdcc31?w=1200&h=300&fit=crop",alt:"Architecture"})}),"\n",(0,i.jsx)(n.p,{children:"This document describes the technical architecture of AgentOps, including how the SDK works, data flow, and infrastructure components."}),"\n",(0,i.jsx)(n.h2,{id:"system-overview",children:"System Overview"}),"\n",(0,i.jsx)(n.mermaid,{value:'flowchart TB\n    subgraph Client["Client Environment"]\n        subgraph App["Your Application"]\n            Agent[Agent Code] --\x3e LLM[LLM Calls]\n            LLM --\x3e Tools[Tools/Functions]\n        end\n\n        subgraph SDK["AgentOps SDK"]\n            Instrument[Instrumentation] --\x3e Builder[Event Builder]\n            Builder --\x3e Queue[Queue Manager]\n            Queue --\x3e HTTP[HTTP Client]\n        end\n\n        App --\x3e SDK\n    end\n\n    subgraph Cloud["AgentOps Cloud"]\n        subgraph Gateway["API Gateway"]\n            Auth[Auth] --\x3e Rate[Rate Limiter]\n            Rate --\x3e Route[Router]\n            Route --\x3e LB[Load Balancer]\n        end\n\n        subgraph Pipeline["Processing Pipeline"]\n            Ingest[Event Ingestion] --\x3e Enrich[Data Enricher]\n            Enrich --\x3e Cost[Cost Calculator]\n            Cost --\x3e Analytics[Analytics Engine]\n        end\n\n        subgraph Storage["Data Storage"]\n            SessionDB[(Sessions DB)]\n            EventDB[(Events DB)]\n            MetricsDB[(Metrics DB)]\n        end\n\n        subgraph Dashboard["Dashboard & API"]\n            WebApp[Web App]\n            REST[REST API]\n            WS[WebSocket Server]\n        end\n\n        Gateway --\x3e Pipeline\n        Pipeline --\x3e Storage\n        Storage --\x3e Dashboard\n    end\n\n    HTTP --\x3e|HTTPS| Gateway\n\n    style Agent fill:#0066FF,stroke:#3399FF,color:#fff\n    style Analytics fill:#22C55E,stroke:#16A34A,color:#fff\n    style WebApp fill:#8B5CF6,stroke:#7C3AED,color:#fff'}),"\n",(0,i.jsx)(n.h2,{id:"sdk-architecture",children:"SDK Architecture"}),"\n",(0,i.jsx)(n.h3,{id:"component-overview",children:"Component Overview"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# Internal SDK structure (conceptual)\n\nclass AgentOps:\n    """Main AgentOps SDK class"""\n\n    def __init__(self):\n        self.client = HTTPClient()        # HTTP communication\n        self.queue = EventQueue()          # Event buffering\n        self.instrumentor = Instrumentor() # Auto-instrumentation\n        self.session_manager = SessionManager()\n'})}),"\n",(0,i.jsx)(n.h3,{id:"auto-instrumentation",children:"Auto-Instrumentation"}),"\n",(0,i.jsx)(n.p,{children:"AgentOps uses monkey-patching to automatically instrument LLM provider libraries:"}),"\n",(0,i.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant App as Your Application\n    participant Wrapper as AgentOps Wrapper\n    participant Original as Original LLM Client\n    participant Queue as Event Queue\n\n    App->>Wrapper: client.chat.completions.create(...)\n    Note over Wrapper: 1. Capture start time\n    Note over Wrapper: 2. Record request parameters\n    Wrapper->>Original: Call original method\n    Original--\x3e>Wrapper: Response\n    Note over Wrapper: 3. Capture response\n    Note over Wrapper: 4. Calculate tokens/cost\n    Wrapper->>Queue: Queue event (async)\n    Wrapper--\x3e>App: Return response"}),"\n",(0,i.jsx)(n.h3,{id:"event-queue",children:"Event Queue"}),"\n",(0,i.jsx)(n.p,{children:"Events are queued and sent in batches for efficiency:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'class EventQueue:\n    """Manages event batching and transmission"""\n\n    def __init__(self, max_size=100, max_wait_ms=5000):\n        self.queue = []\n        self.max_size = max_size\n        self.max_wait_ms = max_wait_ms\n        self.worker_thread = Thread(target=self._process_queue)\n\n    def add(self, event):\n        self.queue.append(event)\n        if len(self.queue) >= self.max_size:\n            self._flush()\n\n    def _process_queue(self):\n        while True:\n            sleep(self.max_wait_ms / 1000)\n            if self.queue:\n                self._flush()\n\n    def _flush(self):\n        events = self.queue.copy()\n        self.queue.clear()\n        self._send_batch(events)\n'})}),"\n",(0,i.jsx)(n.h2,{id:"data-models",children:"Data Models"}),"\n",(0,i.jsx)(n.h3,{id:"session-schema",children:"Session Schema"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'interface Session {\n  id: string;                    // Unique session ID (UUID)\n  project_id: string;            // Project identifier\n  start_timestamp: string;       // ISO 8601 timestamp\n  end_timestamp?: string;        // ISO 8601 timestamp\n  end_state?: "Success" | "Fail" | "Indeterminate";\n  end_state_reason?: string;\n  tags: string[];\n  host_env: {\n    os: string;\n    python_version: string;\n    sdk_version: string;\n  };\n  config: Record<string, any>;\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"event-schema",children:"Event Schema"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'interface Event {\n  id: string;                    // Unique event ID\n  session_id: string;            // Parent session\n  event_type: string;            // Type identifier\n  timestamp: string;             // ISO 8601 timestamp\n  params: Record<string, any>;   // Event-specific data\n  result?: "success" | "fail" | "indeterminate";\n}\n\ninterface LLMEvent extends Event {\n  event_type: "llm";\n  params: {\n    provider: string;            // "openai", "anthropic", etc.\n    model: string;               // "gpt-4", "claude-3", etc.\n    prompt: Message[];           // Input messages\n    completion: string;          // Output text\n    prompt_tokens: number;\n    completion_tokens: number;\n    cost: number;\n    latency_ms: number;\n  };\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"agent-schema",children:"Agent Schema"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"interface Agent {\n  id: string;\n  session_id: string;\n  name: string;\n  agent_class: string;\n  created_at: string;\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"communication-protocol",children:"Communication Protocol"}),"\n",(0,i.jsx)(n.h3,{id:"event-submission",children:"Event Submission"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:'POST /v1/events HTTP/1.1\nHost: api.agentops.ai\nAuthorization: Bearer <api-key>\nContent-Type: application/json\n\n{\n  "session_id": "sess_abc123",\n  "events": [\n    {\n      "event_type": "llm",\n      "timestamp": "2024-01-15T10:30:00Z",\n      "params": {...}\n    }\n  ]\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"response-format",children:"Response Format"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "status": "success",\n  "processed": 5,\n  "failed": 0,\n  "errors": []\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"security-architecture",children:"Security Architecture"}),"\n",(0,i.jsx)(n.h3,{id:"authentication-flow",children:"Authentication Flow"}),"\n",(0,i.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant SDK as Client SDK\n    participant Gateway as API Gateway\n    participant Auth as Auth Service\n\n    SDK->>Gateway: Request + API Key Header\n    Gateway->>Auth: Validate Key\n    Auth--\x3e>Gateway: Key Valid + Project ID\n    Gateway--\x3e>SDK: 200 OK\n\n    Note over SDK,Auth: All subsequent requests use validated session"}),"\n",(0,i.jsx)(n.h3,{id:"data-encryption",children:"Data Encryption"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Layer"}),(0,i.jsx)(n.th,{children:"Encryption"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Transport"}),(0,i.jsx)(n.td,{children:"TLS 1.3"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Storage"}),(0,i.jsx)(n.td,{children:"AES-256"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"API Keys"}),(0,i.jsx)(n.td,{children:"Hashed with bcrypt"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"scalability",children:"Scalability"}),"\n",(0,i.jsx)(n.h3,{id:"horizontal-scaling",children:"Horizontal Scaling"}),"\n",(0,i.jsx)(n.mermaid,{value:"flowchart TB\n    LB[Load Balancer] --\x3e API1[API Server 1]\n    LB --\x3e API2[API Server 2]\n    LB --\x3e API3[API Server 3]\n\n    API1 --\x3e MQ[(Message Queue)]\n    API2 --\x3e MQ\n    API3 --\x3e MQ\n\n    MQ --\x3e W1[Worker 1]\n    MQ --\x3e W2[Worker 2]\n    MQ --\x3e W3[Worker 3]\n\n    W1 --\x3e DB[(Database Cluster)]\n    W2 --\x3e DB\n    W3 --\x3e DB\n\n    style LB fill:#0066FF,stroke:#3399FF,color:#fff\n    style MQ fill:#F59E0B,stroke:#D97706,color:#fff\n    style DB fill:#22C55E,stroke:#16A34A,color:#fff"}),"\n",(0,i.jsx)(n.h3,{id:"data-partitioning",children:"Data Partitioning"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Sessions partitioned by project ID"}),"\n",(0,i.jsx)(n.li,{children:"Events partitioned by timestamp"}),"\n",(0,i.jsx)(n.li,{children:"Metrics aggregated hourly/daily"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"performance-characteristics",children:"Performance Characteristics"}),"\n",(0,i.jsx)(n.h3,{id:"sdk-overhead",children:"SDK Overhead"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Operation"}),(0,i.jsx)(n.th,{children:"Overhead"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Event recording"}),(0,i.jsx)(n.td,{children:"< 1ms"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Queue flush"}),(0,i.jsx)(n.td,{children:"Async, non-blocking"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Memory usage"}),(0,i.jsx)(n.td,{children:"< 10MB typical"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"api-latency",children:"API Latency"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Endpoint"}),(0,i.jsx)(n.th,{children:"P50"}),(0,i.jsx)(n.th,{children:"P99"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Event ingestion"}),(0,i.jsx)(n.td,{children:"50ms"}),(0,i.jsx)(n.td,{children:"200ms"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Session query"}),(0,i.jsx)(n.td,{children:"100ms"}),(0,i.jsx)(n.td,{children:"500ms"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Dashboard load"}),(0,i.jsx)(n.td,{children:"200ms"}),(0,i.jsx)(n.td,{children:"1s"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"reliability",children:"Reliability"}),"\n",(0,i.jsx)(n.h3,{id:"retry-logic",children:"Retry Logic"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"class HTTPClient:\n    def send(self, data, max_retries=3):\n        for attempt in range(max_retries):\n            try:\n                response = self._post(data)\n                if response.ok:\n                    return response\n            except Exception as e:\n                if attempt == max_retries - 1:\n                    raise\n                sleep(2 ** attempt)  # Exponential backoff\n"})}),"\n",(0,i.jsx)(n.h3,{id:"failure-handling",children:"Failure Handling"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Events buffered locally on network failure"}),"\n",(0,i.jsx)(n.li,{children:"Automatic retry with exponential backoff"}),"\n",(0,i.jsx)(n.li,{children:"Dead letter queue for failed events"}),"\n",(0,i.jsx)(n.li,{children:"Graceful degradation (agent continues working)"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/core-concepts/sessions",children:"Sessions"})," - Deep dive into session management"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/core-concepts/events",children:"Events"})," - Understanding event types"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/advanced/performance",children:"Performance"})," - Optimization tips"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453(e,n,t){t.d(n,{R:()=>a,x:()=>c});var s=t(6540);const i={},r=s.createContext(i);function a(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);